<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒ„ì†Œí•©ê¸ˆê°• S íˆ¬ì…ëŸ‰ ì‹œë®¬ë ˆì´í„°</title>
    <!-- Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --bg-color: #f4f7f6;
            --panel-bg: #ffffff;
            --border-color: #dce4ec;
            --header-bg: #EAF2F8;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--primary-color);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 { margin: 0; font-size: 1.6rem; }
        h2 {
            margin: 0 0 10px 0;
            font-size: 1rem;
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 5px;
            background-color: var(--header-bg);
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }

        /* ê³µí†µ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .panel {
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
            margin-bottom: 15px;
        }

        /* ìƒë‹¨: ì„±ë¶„ ë°ì´í„° (3ì—´ ê°€ë¡œ ë°°ì¹˜) */
        .top-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .top-section .panel {
            flex: 1;
            margin-bottom: 0;
        }

        /* í•˜ë‹¨: ë©”ì¸ ë ˆì´ì•„ì›ƒ (ì™¼ìª½: ê³µì •ë³€ìˆ˜ / ì˜¤ë¥¸ìª½: ê²°ê³¼) */
        .bottom-section {
            display: flex;
            gap: 20px;
        }

        .left-sidebar {
            flex: 0 0 350px; /* ê³ ì • ë„ˆë¹„ */
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        th, td {
            padding: 5px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        /* ì…ë ¥ í•„ë“œ */
        input[type="number"] {
            width: 100%;
            padding: 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: right;
            box-sizing: border-box;
        }

        /* ê³µì • ë³€ìˆ˜ ê·¸ë¦¬ë“œ (1ì—´ ë°°ì¹˜ë¡œ ë³€ê²½) */
        .process-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .input-group label {
            font-size: 0.9rem; /* í°íŠ¸ ì¡°ê¸ˆ í‚¤ì›€ */
            font-weight: 500;
            color: #555;
        }
        .input-group input {
            width: 100px; /* ì…ë ¥ì°½ ë„ˆë¹„ ì¡°ê¸ˆ í‚¤ì›€ */
        }

        /* ê²°ê³¼ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .result-panel {
            background-color: #eaf2f8;
            border: 1px solid #b8cddb;
            height: 100%; /* ê½‰ ì±„ìš°ê¸° */
            display: flex;
            flex-direction: column;
        }

        .target-input {
            border: 2px solid var(--secondary-color) !important;
            font-weight: bold;
            color: var(--secondary-color);
            font-size: 1.2rem !important;
            text-align: center !important;
            width: 140px !important;
        }

        .btn-calc {
            width: 100%;
            padding: 15px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin: 20px 0;
            transition: background 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-calc:hover {
            background-color: #2980b9;
        }

        .result-box-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .result-item {
            flex: 1;
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dce4ec;
        }
        .result-label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        .result-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .result-unit {
            font-size: 1rem;
            color: #888;
        }

        /* ì°¨íŠ¸ ì˜ì—­ */
        .chart-container {
            position: relative;
            flex: 1; /* ë‚¨ì€ ê³µê°„ ì°¨ì§€ */
            min-height: 300px;
            width: 100%;
            background: white;
            border-radius: 8px;
            padding: 10px;
            box-sizing: border-box;
        }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>íƒ„ì†Œí•©ê¸ˆê°• S íˆ¬ì…ëŸ‰ ì‹œë®¬ë ˆì´í„°</h1>
    </header>

    <!-- [ìƒë‹¨] ì„±ë¶„ ë°ì´í„° (31 -> 32 -> 41) -->
    <div class="top-section">
        <div class="panel">
            <h2>ì„±ë¶„ ë°ì´í„° (31: LFì´ˆ)</h2>
            <table>
                <thead><tr><th>ì„±ë¶„</th><th>í•¨ëŸ‰(%)</th></tr></thead>
                <tbody>
                    <tr><td>C_31</td><td><input type="number" id="C_31" value="0.105" step="0.001"></td></tr>
                    <tr><td>Si_31</td><td><input type="number" id="Si_31" value="0.202" step="0.001"></td></tr>
                    <tr><td>Mn_31</td><td><input type="number" id="Mn_31" value="0.544" step="0.001"></td></tr>
                    <tr><td>S_31</td><td><input type="number" id="S_31" value="0.0097" step="0.0001"></td></tr>
                    <tr><td>Al_31</td><td><input type="number" id="Al_31" value="0.0255" step="0.0001"></td></tr>
                </tbody>
            </table>
        </div>

        <div class="panel">
            <h2>ì„±ë¶„ ë°ì´í„° (32: LFë§)</h2>
            <table>
                <thead><tr><th>ì„±ë¶„</th><th>í•¨ëŸ‰(%)</th></tr></thead>
                <tbody>
                    <tr><td>C_32</td><td><input type="number" id="C_32" value="0.422" step="0.001"></td></tr>
                    <tr><td>Si_32</td><td><input type="number" id="Si_32" value="0.233" step="0.001"></td></tr>
                    <tr><td>Mn_32</td><td><input type="number" id="Mn_32" value="0.670" step="0.001"></td></tr>
                    <tr><td>S_32</td><td><input type="number" id="S_32" value="0.0047" step="0.0001"></td></tr>
                    <tr><td>Al_32</td><td><input type="number" id="Al_32" value="0.0149" step="0.0001"></td></tr>
                </tbody>
            </table>
        </div>

        <div class="panel">
            <h2>ì„±ë¶„ ë°ì´í„° (41: VDì¤‘)</h2>
            <table>
                <thead><tr><th>ì„±ë¶„</th><th>í•¨ëŸ‰(%)</th></tr></thead>
                <tbody>
                    <tr><td>C_41</td><td><input type="number" id="C_41" value="0.475" step="0.001"></td></tr>
                    <tr><td>Si_41</td><td><input type="number" id="Si_41" value="0.208" step="0.001"></td></tr>
                    <tr><td>Mn_41</td><td><input type="number" id="Mn_41" value="0.713" step="0.001"></td></tr>
                    <tr><td>S_41</td><td><input type="number" id="S_41" value="0.0052" step="0.0001"></td></tr>
                    <tr><td>Al_41</td><td><input type="number" id="Al_41" value="0.0097" step="0.0001"></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- [í•˜ë‹¨] ì™¼ìª½: ê³µì •ë³€ìˆ˜ / ì˜¤ë¥¸ìª½: ê²°ê³¼ ë° ì°¨íŠ¸ -->
    <div class="bottom-section">
        
        <!-- ì™¼ìª½ ì‚¬ì´ë“œë°”: ê³µì • ë³€ìˆ˜ ì…ë ¥ -->
        <div class="left-sidebar">
            <div class="panel">
                <h2>LF ê³µì • ë³€ìˆ˜</h2>
                <div class="process-grid">
                    <div class="input-group"><label>LF_Al(P)</label><input type="number" id="LF_AL_P" value="79.1"></div>
                    <div class="input-group"><label>LF_ìƒì„íšŒ</label><input type="number" id="LF_lime" value="0"></div>
                    <div class="input-group"><label>LF_í˜•ì„</label><input type="number" id="LF_fluorite" value="0"></div>
                    <div class="input-group"><label>LF_Hidex</label><input type="number" id="LF_Hidex" value="250"></div>
                    <div class="input-group"><label>LF_í•˜ì´ë§ê°„</label><input type="number" id="LF_himan" value="234"></div>
                    <div class="input-group"><label>LF_SI_MN</label><input type="number" id="LF_SI_MN" value="0"></div>
                    <div class="input-group"><label>LF_Fe-Si</label><input type="number" id="LF_Fe_Si" value="71"></div>
                    <div class="input-group"><label>LF ì‹œê°„</label><input type="number" id="LF_time" value="79.1"></div>
                </div>
                <div style="font-size: 0.8rem; color: #888; text-align: right; margin-top: 5px;">* Deox1, Al_Total_Input ìë™ ê³„ì‚°ë¨</div>
            </div>

            <div class="panel">
                <h2>VD ê³µì • ë³€ìˆ˜</h2>
                <div class="process-grid">
                    <div class="input-group"><label>VDì´ˆ_Alíˆ¬ì…</label><input type="number" id="VD_start_Al" value="0"></div>
                    <div class="input-group"><label>VDë§_Alíˆ¬ì…</label><input type="number" id="VD_end_Al" value="8"></div>
                    <div class="input-group"><label>VDì´ˆ_Síˆ¬ì…</label><input type="number" id="VD_start_S" value="0"></div>
                    <!-- VDë§ Síˆ¬ì…ì€ ê²°ê³¼ê°’ì´ë¯€ë¡œ ì œì™¸ -->
                </div>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ ë©”ì¸: ê²°ê³¼ ì‹œë®¬ë ˆì´ì…˜ -->
        <div class="main-content">
            <div class="panel result-panel">
                <h2>ğŸ¯ S ì„±ë¶„ ì œì–´ ì‹œë®¬ë ˆì´ì…˜</h2>
                
                <!-- ëª©í‘œ ì„¤ì • ë° ë²„íŠ¼ -->
                <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 10px;">
                    <label style="font-size: 1.2rem; font-weight: bold; color: #2c3e50;">S_91 Target (%):</label>
                    <input type="number" id="S_91_Target" class="target-input" value="0.0080" step="0.0001">
                </div>

                <button class="btn-calc" onclick="calculateSInput()">ìµœì  íˆ¬ì…ëŸ‰ ê³„ì‚° (Calculate)</button>

                <!-- ê²°ê³¼ ë°•ìŠ¤ -->
                <div class="result-box-container">
                    <div class="result-item">
                        <div class="result-label">VDë§ S íˆ¬ì…ëŸ‰ (kg)</div>
                        <div class="result-value" id="res_kg">-</div>
                    </div>
                    <div class="result-item" style="background-color: #f8f9fa;">
                        <div class="result-label">VDë§ S íˆ¬ì…ëŸ‰ (m)</div>
                        <div class="result-value" id="res_m" style="color: #3498db;">-</div>
                        <div class="result-unit">(ë°˜ì˜¬ë¦¼ ì •ìˆ˜)</div>
                    </div>
                </div>

                <!-- ì°¨íŠ¸ -->
                <div class="chart-container">
                    <canvas id="sContentChart"></canvas>
                </div>
                
                <div style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: #666;">
                    * ì‹¤ì„ : ì˜ˆìƒ S í•¨ëŸ‰ | ìŒì˜: ì˜ˆì¸¡ ì˜¤ì°¨ (RMSE Â±0.004%) | <span style="color: #e74c3c;">â—</span>: Target
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // ==========================================================================
    // [ì„¤ì •] Altair AI Studio ì„ í˜•íšŒê·€ ëª¨ë¸ ê³„ìˆ˜ (Coefficient)
    // ==========================================================================
    const coefficients = {
        intercept: 26.37, 

        // ì„±ë¶„ ë³€ìˆ˜
        C_31: 0.00233210980484848,
        SI_31: 0, 
        MN_31: -0.00123346877633798,
        S_31: -0.0806606110675721,
        Al_31: 0.0090054809788279,
        
        C_32: 0.00185548850846297,
        SI_32: -0.00138812030920863,
        MN_32: -0.00268899700966789,
        S_32: 0, 
        Al_32: 0.0222495843719425,
        
        C_41: 0, 
        SI_41: 0.00188842208634346,
        MN_41: 0.000952814853377037,
        S_41: 0.925086191410987,
        Al_41: -0.0494444503609697,

        // íŒŒìƒ ë³€ìˆ˜
        Deox1: 0.0249960937297486,
        Al_Total_Input: 0.0229284911558482,

        // ê³µì • ë³€ìˆ˜
        LF_time: -0.0226847558067848,
        LF_lime: 0.00296830065938176, 
        LF_fluorite: 0.00494380104021295,
        LF_himan: -0.0151204421996644,
        LF_SI_MN: -0.0274198831972041,
        LF_Fe_Si: -0.0158619806416286,
        
        VD_start_Al: -0.0681928309095175,
        VD_end_Al: 0.0420419195348036, 
        VD_start_S: 0.0337236037595545, 

        // *** [ì¤‘ìš”] ì‚¬ìš©ì ê²½í—˜ ë°˜ì˜ ê³„ìˆ˜ ë³´ì • (9.33) ***
        VD_end_S_Coef: 9.3333
    };

    let sChart = null;

    function calculateSInput() {
        const scale = 10000;

        const data = {
            C_31: parseFloat(document.getElementById('C_31').value) * scale,
            Si_31: parseFloat(document.getElementById('Si_31').value) * scale,
            Mn_31: parseFloat(document.getElementById('Mn_31').value) * scale,
            S_31: parseFloat(document.getElementById('S_31').value) * scale,
            Al_31: parseFloat(document.getElementById('Al_31').value) * scale,

            C_32: parseFloat(document.getElementById('C_32').value) * scale,
            Si_32: parseFloat(document.getElementById('Si_32').value) * scale,
            Mn_32: parseFloat(document.getElementById('Mn_32').value) * scale,
            S_32: parseFloat(document.getElementById('S_32').value) * scale,
            Al_32: parseFloat(document.getElementById('Al_32').value) * scale,

            C_41: parseFloat(document.getElementById('C_41').value) * scale,
            Si_41: parseFloat(document.getElementById('Si_41').value) * scale,
            Mn_41: parseFloat(document.getElementById('Mn_41').value) * scale,
            S_41: parseFloat(document.getElementById('S_41').value) * scale,
            Al_41: parseFloat(document.getElementById('Al_41').value) * scale,

            LF_AL_P: parseFloat(document.getElementById('LF_AL_P').value),
            LF_lime: parseFloat(document.getElementById('LF_lime').value),
            LF_fluorite: parseFloat(document.getElementById('LF_fluorite').value),
            LF_Hidex: parseFloat(document.getElementById('LF_Hidex').value),
            LF_himan: parseFloat(document.getElementById('LF_himan').value),
            LF_SI_MN: parseFloat(document.getElementById('LF_SI_MN').value),
            LF_Fe_Si: parseFloat(document.getElementById('LF_Fe_Si').value),
            LF_time: parseFloat(document.getElementById('LF_time').value),
            
            VD_start_Al: parseFloat(document.getElementById('VD_start_Al').value),
            VD_end_Al: parseFloat(document.getElementById('VD_end_Al').value),
            VD_start_S: parseFloat(document.getElementById('VD_start_S').value),
            
            Target_S: parseFloat(document.getElementById('S_91_Target').value) * scale
        };

        const Deox1 = data.S_32 - data.S_31;
        const Al_Total_Input = data.LF_AL_P + (data.LF_Hidex * 0.4);

        let basePrediction = coefficients.intercept;

        basePrediction += (coefficients.C_31 * data.C_31);
        basePrediction += (coefficients.MN_31 * data.Mn_31);
        basePrediction += (coefficients.S_31 * data.S_31);
        basePrediction += (coefficients.Al_31 * data.Al_31);

        basePrediction += (coefficients.C_32 * data.C_32);
        basePrediction += (coefficients.SI_32 * data.Si_32);
        basePrediction += (coefficients.MN_32 * data.Mn_32);
        basePrediction += (coefficients.Al_32 * data.Al_32);

        basePrediction += (coefficients.SI_41 * data.Si_41);
        basePrediction += (coefficients.MN_41 * data.Mn_41);
        basePrediction += (coefficients.S_41 * data.S_41); 
        basePrediction += (coefficients.Al_41 * data.Al_41);

        basePrediction += (coefficients.Deox1 * Deox1);
        basePrediction += (coefficients.Al_Total_Input * Al_Total_Input);

        basePrediction += (coefficients.LF_time * data.LF_time);
        basePrediction += (coefficients.LF_lime * data.LF_lime);
        basePrediction += (coefficients.LF_fluorite * data.LF_fluorite);
        basePrediction += (coefficients.LF_himan * data.LF_himan);
        basePrediction += (coefficients.LF_SI_MN * data.LF_SI_MN);
        basePrediction += (coefficients.LF_Fe_Si * data.LF_Fe_Si);
        
        basePrediction += (coefficients.VD_start_Al * data.VD_start_Al);
        basePrediction += (coefficients.VD_end_Al * data.VD_end_Al);
        basePrediction += (coefficients.VD_start_S * data.VD_start_S);

        const gap = data.Target_S - basePrediction;
        let requiredInput = 0;

        if (coefficients.VD_end_S_Coef !== 0) {
            requiredInput = gap / coefficients.VD_end_S_Coef;
        } else {
            alert("ì˜¤ë¥˜: ê³„ìˆ˜ ì„¤ì • í™•ì¸ í•„ìš”");
            return;
        }

        const resKg = document.getElementById('res_kg');
        const resM = document.getElementById('res_m');

        if (requiredInput < 0) {
            resKg.innerText = "0";
            resM.innerText = "0";
        } else {
            resKg.innerText = requiredInput.toFixed(1);
            const inputInMeters = Math.round(requiredInput / 0.365);
            resM.innerText = inputInMeters;
        }

        updateChart(basePrediction, coefficients.VD_end_S_Coef, requiredInput);
    }

    function updateChart(baseS, sCoef, targetInput) {
        const ctx = document.getElementById('sContentChart').getContext('2d');
        
        const maxInput = Math.max(targetInput * 1.5, 50); 
        const step = maxInput / 10;
        
        const data = [];
        const rmse = 40; 

        for (let i = 0; i <= 10; i++) {
            const inputKg = i * step;
            const predictedS = baseS + (sCoef * inputKg);
            const sPercent = predictedS / 10000;
            const upperBound = (predictedS + rmse) / 10000;
            const lowerBound = (predictedS - rmse) / 10000;

            data.push({
                x: inputKg,
                y: sPercent,
                upper: upperBound,
                lower: lowerBound
            });
        }

        if (sChart) {
            sChart.destroy();
        }

        sChart = new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: 'ì˜ˆìƒ S í•¨ëŸ‰ (%)',
                        data: data.map(d => ({x: d.x, y: d.y})),
                        type: 'line',
                        borderColor: '#3498db',
                        backgroundColor: '#3498db',
                        borderWidth: 3,
                        pointRadius: 4,
                        fill: false,
                        tension: 0.1
                    },
                    {
                        label: 'ì˜¤ì°¨ ìƒí•œ',
                        data: data.map(d => ({x: d.x, y: d.upper})),
                        type: 'line',
                        borderColor: 'rgba(52, 152, 219, 0.2)',
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderWidth: 1,
                        pointRadius: 0,
                        fill: '+1',
                        tension: 0.4
                    },
                    {
                        label: 'ì˜¤ì°¨ í•˜í•œ',
                        data: data.map(d => ({x: d.x, y: d.lower})),
                        type: 'line',
                        borderColor: 'rgba(52, 152, 219, 0.2)',
                        borderWidth: 1,
                        pointRadius: 0,
                        fill: false,
                        tension: 0.4
                    },
                    {
                        label: 'Target Point',
                        data: [{x: targetInput, y: parseFloat(document.getElementById('S_91_Target').value)}],
                        type: 'scatter',
                        backgroundColor: '#e74c3c',
                        pointRadius: 8,
                        pointHoverRadius: 10
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'linear',
                        title: { display: true, text: 'VDë§ S íˆ¬ì…ëŸ‰ (kg)' },
                        min: 0,
                        max: maxInput
                    },
                    y: {
                        title: { display: true, text: 'S_91 í•¨ëŸ‰ (%)' },
                        ticks: { callback: function(value) { return value.toFixed(4) + '%'; } }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                if (context.dataset.label === 'Target Point') {
                                    return `ëª©í‘œ: ${context.raw.x.toFixed(1)}kg íˆ¬ì… â†’ ${context.raw.y.toFixed(4)}%`;
                                }
                                return `${context.parsed.y.toFixed(4)}%`;
                            }
                        }
                    },
                    legend: {
                        labels: {
                            filter: function(item, chart) { return !item.text.includes('ì˜¤ì°¨'); }
                        }
                    }
                }
            }
        });
    }
</script>

</body>
</html>
